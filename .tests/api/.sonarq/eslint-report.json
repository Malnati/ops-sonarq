[{"filePath":"/root/w/ops-sonarq/.tests/api/src/database.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DB_PASS' is assigned a value but never used.","line":4,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 2 times.","line":4,"column":17,"nodeType":"Literal","messageId":"defineConstant","endLine":4,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[852,855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[852,855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'newHost' is defined but never used.","line":49,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'debugInfo' is assigned a value but never used.","line":60,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":60,"endColumn":18}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Vulnerability: hardcoded database credentials\nconst DB_HOST = \"production-db.internal.company.com\";\nconst DB_USER = \"root\";\nconst DB_PASS = \"P@ssw0rd!2024\";\nconst DB_PORT = 5432;\n\ninterface DbConnection {\n  host: string;\n  user: string;\n  password: string;\n  connected: boolean;\n}\n\nlet connection: DbConnection | null = null;\n\n// Vulnerability: credentials in function parameters with defaults\nexport function connectDb(\n  user: string = \"root\",\n  password: string = \"P@ssw0rd!2024\",\n): DbConnection {\n  connection = {\n    host: DB_HOST,\n    user,\n    password,\n    connected: true,\n  };\n  // Vulnerability: logging credentials\n  console.log(`Connected to ${DB_HOST} as ${user} with password ${password}`);\n  return connection;\n}\n\n// Bug: function never checks if connection is null before using it\nexport async function query(sql: string): Promise<any[]> {\n  console.log(\"Executing SQL:\", sql);\n  // Vulnerability: no input sanitization\n  return [];\n}\n\n// Code smell: useless function\nexport function disconnect(): void {\n  if (connection) {\n    connection = null;\n  } else {\n    connection = null;\n  }\n}\n\n// Bug: self-assignment\nexport function updateConnectionHost(newHost: string): void {\n  if (connection) {\n    connection.host = connection.host;\n  }\n}\n\n// Code smell: unused imports and dead store\nexport function getConnectionInfo(): string {\n  const port = DB_PORT;\n  const host = DB_HOST;\n  const info = `${host}:${port}`;\n  const debugInfo = `Debug: ${DB_USER}@${host}`;\n  return info;\n}\n","usedDeprecatedRules":[]},{"filePath":"/root/w/ops-sonarq/.tests/api/src/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'db' is assigned a value but never used.","line":5,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":9},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 0.1.","line":12,"column":17,"nodeType":"Literal","messageId":"noMagic","endLine":12,"endColumn":20},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 0.2.","line":12,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":12,"endColumn":26},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 0.3.","line":13,"column":16,"nodeType":"Literal","messageId":"noMagic","endLine":13,"endColumn":19},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 100.","line":23,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":23,"endColumn":33}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getUserData } from \"./user-service\";\nimport { processPayment } from \"./payment\";\nimport { connectDb } from \"./database\";\n\nconst db = connectDb(\"admin\", \"admin123\");\n\nasync function main() {\n  const user = await getUserData(1);\n  console.log(user);\n\n  // Bug: floating point comparison\n  const price = 0.1 + 0.2;\n  if (price == 0.3) {\n    console.log(\"match\");\n  }\n\n  // Bug: always-true condition\n  const x = 5;\n  if (x >= 0 || x < 0) {\n    console.log(\"always true\");\n  }\n\n  await processPayment(user, 100);\n}\n\nmain();\n","usedDeprecatedRules":[]},{"filePath":"/root/w/ops-sonarq/.tests/api/src/payment.ts","messages":[{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 0.1.","line":12,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":12,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'retries' is assigned a value but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":10},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 3.","line":15,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":15,"endColumn":22},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 1000.","line":25,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":25,"endColumn":31},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 100.","line":25,"column":52,"nodeType":"Literal","messageId":"noMagic","endLine":25,"endColumn":55},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 10.","line":25,"column":78,"nodeType":"Literal","messageId":"noMagic","endLine":25,"endColumn":80},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 0.2.","line":71,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":71,"endColumn":15},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 0.1.","line":73,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":73,"endColumn":15},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 0.1.","line":75,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":75,"endColumn":15}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { User } from \"./user-service\";\n\n// Vulnerability: hardcoded credentials\nconst API_KEY = \"sk_live_abc123def456ghi789\";\nconst SECRET = \"super-secret-payment-key-2024\";\n\n// Code smell: too many parameters\nexport async function processPayment(\n  user: User,\n  amount: number,\n  currency: string = \"USD\",\n  taxRate: number = 0.1,\n  discount: number = 0,\n  promoCode: string = \"\",\n  retries: number = 3,\n): Promise<{ success: boolean; transactionId: string }> {\n  // Bug: possible division by zero\n  const finalAmount = amount / discount;\n\n  // Vulnerability: logging sensitive data\n  console.log(\"Processing payment with API_KEY:\", API_KEY);\n  console.log(\"User password:\", user.password);\n\n  // Code smell: nested ternary\n  const status = amount > 1000 ? \"high\" : amount > 100 ? \"medium\" : amount > 10 ? \"low\" : \"micro\";\n\n  // Bug: comparison with NaN\n  if (finalAmount === NaN) {\n    return { success: false, transactionId: \"\" };\n  }\n\n  const tax = finalAmount * taxRate;\n  const total = finalAmount + tax;\n\n  // Code smell: empty catch block\n  try {\n    const response = await fetch(\"https://api.payments.com/charge\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": \"Bearer \" + SECRET,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        user_id: user.id,\n        amount: total,\n        currency,\n        status,\n        promo: promoCode,\n        key: API_KEY,\n      }),\n    });\n    return await response.json();\n  } catch (e) {\n  }\n\n  return { success: false, transactionId: \"\" };\n}\n\n// Bug: infinite loop possibility\nexport function retryPayment(userId: number): void {\n  let success = false;\n  while (!success) {\n    console.log(\"Retrying payment for user\", userId);\n    // missing: success = tryPayment();\n  }\n}\n\n// Code smell: identical branches\nexport function getDiscount(tier: string): number {\n  if (tier === \"gold\") {\n    return 0.2;\n  } else if (tier === \"silver\") {\n    return 0.1;\n  } else if (tier === \"bronze\") {\n    return 0.1;\n  }\n  return 0;\n}\n","usedDeprecatedRules":[]},{"filePath":"/root/w/ops-sonarq/.tests/api/src/user-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[217,220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[217,220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 3 times.","line":37,"column":29,"nodeType":"Literal","messageId":"defineConstant","endLine":37,"endColumn":43},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 5.","line":38,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":38,"endColumn":31},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 5.","line":44,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":44,"endColumn":31},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 5.","line":52,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":52,"endColumn":31},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 5.","line":58,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":58,"endColumn":31},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 5.","line":66,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":66,"endColumn":31},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 5.","line":72,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":72,"endColumn":31}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { query } from \"./database\";\n\nexport interface User {\n  id: number;\n  name: string;\n  email: string;\n  password: string;\n  role: string;\n}\n\n// Vulnerability: SQL injection\nexport async function getUserData(id: any): Promise<User> {\n  const sql = \"SELECT * FROM users WHERE id = \" + id;\n  const rows = await query(sql);\n  return rows[0] as User;\n}\n\n// Vulnerability: SQL injection via string concatenation\nexport async function findUserByName(name: string): Promise<User[]> {\n  const sql = \"SELECT * FROM users WHERE name = '\" + name + \"'\";\n  const rows = await query(sql);\n  return rows as User[];\n}\n\n// Bug: function always returns the same value\nexport function isAdmin(user: User): boolean {\n  if (user.role === \"admin\") {\n    return true;\n  }\n  return true;\n}\n\n// Code smell: overly complex function (cognitive complexity)\nexport function classifyUser(user: User): string {\n  let result = \"\";\n  if (user.role === \"admin\") {\n    if (user.email.includes(\"@company.com\")) {\n      if (user.name.length > 5) {\n        result = \"senior-admin\";\n      } else {\n        result = \"junior-admin\";\n      }\n    } else {\n      if (user.name.length > 5) {\n        result = \"external-admin\";\n      } else {\n        result = \"temp-admin\";\n      }\n    }\n  } else if (user.role === \"editor\") {\n    if (user.email.includes(\"@company.com\")) {\n      if (user.name.length > 5) {\n        result = \"senior-editor\";\n      } else {\n        result = \"junior-editor\";\n      }\n    } else {\n      if (user.name.length > 5) {\n        result = \"external-editor\";\n      } else {\n        result = \"temp-editor\";\n      }\n    }\n  } else {\n    if (user.email.includes(\"@company.com\")) {\n      if (user.name.length > 5) {\n        result = \"internal-user\";\n      } else {\n        result = \"new-user\";\n      }\n    } else {\n      if (user.name.length > 5) {\n        result = \"external-user\";\n      } else {\n        result = \"guest\";\n      }\n    }\n  }\n  return result;\n}\n\n// Code smell: duplicate string literals\nexport function getUserLabel(user: User): string {\n  if (user.role === \"admin\") {\n    return \"Administrator - \" + user.name;\n  }\n  if (user.role === \"editor\") {\n    return \"Editor - \" + user.name;\n  }\n  if (user.role === \"viewer\") {\n    return \"Viewer - \" + user.name;\n  }\n  return \"Unknown - \" + user.name;\n}\n\n// Bug: unused variable + dead code\nexport function processUser(user: User): void {\n  const timestamp = Date.now();\n  const label = getUserLabel(user);\n  console.log(label);\n  return;\n  console.log(\"This code is unreachable\", timestamp);\n}\n","usedDeprecatedRules":[]},{"filePath":"/root/w/ops-sonarq/.tests/api/src/utils.ts","messages":[{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 2.","line":3,"column":31,"nodeType":"Literal","messageId":"noMagic","endLine":3,"endColumn":32},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 2.","line":7,"column":30,"nodeType":"Literal","messageId":"noMagic","endLine":7,"endColumn":31},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 10.","line":52,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":52,"endColumn":22},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 5.","line":53,"column":23,"nodeType":"Literal","messageId":"noMagic","endLine":53,"endColumn":24},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 2.","line":54,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":54,"endColumn":21},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 15.","line":55,"column":21,"nodeType":"Literal","messageId":"noMagic","endLine":55,"endColumn":23},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 3.","line":56,"column":24,"nodeType":"Literal","messageId":"noMagic","endLine":56,"endColumn":25},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 365.","line":57,"column":20,"nodeType":"Literal","messageId":"noMagic","endLine":57,"endColumn":23},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 1.5.","line":58,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":58,"endColumn":17},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 180.","line":59,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":59,"endColumn":30},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 1.25.","line":60,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":60,"endColumn":18},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 90.","line":61,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":61,"endColumn":29},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 1.1.","line":62,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":62,"endColumn":17},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 30.","line":63,"column":27,"nodeType":"Literal","messageId":"noMagic","endLine":63,"endColumn":29},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 1.05.","line":64,"column":14,"nodeType":"Literal","messageId":"noMagic","endLine":64,"endColumn":18},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 10000.","line":66,"column":15,"nodeType":"Literal","messageId":"noMagic","endLine":66,"endColumn":20},{"ruleId":"@typescript-eslint/no-magic-numbers","severity":2,"message":"No magic number: 10000.","line":67,"column":12,"nodeType":"Literal","messageId":"noMagic","endLine":67,"endColumn":17}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Code smell: duplicate logic\nexport function formatCurrency(amount: number): string {\n  return \"$\" + amount.toFixed(2);\n}\n\nexport function formatPrice(price: number): string {\n  return \"$\" + price.toFixed(2);\n}\n\n// Bug: incorrect null check\nexport function getValueOrDefault(value: string | null, fallback: string): string {\n  if (value !== null || value !== undefined) {\n    return value!;\n  }\n  return fallback;\n}\n\n// Vulnerability: eval usage\nexport function calculate(expression: string): number {\n  return eval(expression);\n}\n\n// Code smell: unnecessary boolean comparison\nexport function isActive(flag: boolean): boolean {\n  if (flag === true) {\n    return true;\n  } else if (flag === false) {\n    return false;\n  }\n  return false;\n}\n\n// Bug: off-by-one error in loop\nexport function getLastItems<T>(arr: T[], count: number): T[] {\n  const result: T[] = [];\n  for (let i = arr.length; i > arr.length - count; i--) {\n    result.push(arr[i]);\n  }\n  return result;\n}\n\n// Code smell: excessively long function with magic numbers\nexport function scoreUser(\n  posts: number,\n  comments: number,\n  likes: number,\n  shares: number,\n  followers: number,\n  daysActive: number,\n): number {\n  let score = 0;\n  score += posts * 10;\n  score += comments * 5;\n  score += likes * 2;\n  score += shares * 15;\n  score += followers * 3;\n  if (daysActive > 365) {\n    score *= 1.5;\n  } else if (daysActive > 180) {\n    score *= 1.25;\n  } else if (daysActive > 90) {\n    score *= 1.1;\n  } else if (daysActive > 30) {\n    score *= 1.05;\n  }\n  if (score > 10000) {\n    return 10000;\n  }\n  return Math.round(score);\n}\n","usedDeprecatedRules":[]}]